# Laravel-Go Framework é›†æˆæµ‹è¯• Makefile

.PHONY: help test test-all test-http test-database test-cache-queue test-unit clean coverage report

# é»˜è®¤ç›®æ ‡
help:
	@echo "Laravel-Go Framework é›†æˆæµ‹è¯•ç®¡ç†"
	@echo ""
	@echo "å¯ç”¨å‘½ä»¤:"
	@echo "  make test-all        - è¿è¡Œæ‰€æœ‰é›†æˆæµ‹è¯•"
	@echo "  make test-http       - è¿è¡ŒHTTPé›†æˆæµ‹è¯•"
	@echo "  make test-database   - è¿è¡Œæ•°æ®åº“é›†æˆæµ‹è¯•"
	@echo "  make test-cache-queue - è¿è¡Œç¼“å­˜é˜Ÿåˆ—é›†æˆæµ‹è¯•"
	@echo "  make test-unit       - è¿è¡Œå•å…ƒæµ‹è¯•"
	@echo "  make coverage        - ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š"
	@echo "  make report          - ç”ŸæˆHTMLæµ‹è¯•æŠ¥å‘Š"
	@echo "  make clean           - æ¸…ç†æµ‹è¯•æ–‡ä»¶"
	@echo "  make install-deps    - å®‰è£…æµ‹è¯•ä¾èµ–"

# è¿è¡Œæ‰€æœ‰é›†æˆæµ‹è¯•
test-all:
	@echo "ğŸš€ è¿è¡Œæ‰€æœ‰é›†æˆæµ‹è¯•..."
	go test -v ./tests/... -run "Test.*Integration.*Suite"

# è¿è¡ŒHTTPé›†æˆæµ‹è¯•
test-http:
	@echo "ğŸŒ è¿è¡ŒHTTPé›†æˆæµ‹è¯•..."
	go test -v ./tests/ -run "TestHTTPIntegrationTestSuite"

# è¿è¡Œæ•°æ®åº“é›†æˆæµ‹è¯•
test-database:
	@echo "ğŸ—„ï¸  è¿è¡Œæ•°æ®åº“é›†æˆæµ‹è¯•..."
	go test -v ./tests/ -run "TestDatabaseIntegrationTestSuite"

# è¿è¡Œç¼“å­˜é˜Ÿåˆ—é›†æˆæµ‹è¯•
test-cache-queue:
	@echo "ğŸ’¾ è¿è¡Œç¼“å­˜é˜Ÿåˆ—é›†æˆæµ‹è¯•..."
	go test -v ./tests/ -run "TestCacheQueueIntegrationTestSuite"

# è¿è¡Œå•å…ƒæµ‹è¯•
test-unit:
	@echo "ğŸ§ª è¿è¡Œå•å…ƒæµ‹è¯•..."
	go test -v ../framework/... -short

# ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
coverage:
	@echo "ğŸ“Š ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š..."
	go test -v -coverprofile=coverage.out ./... ../framework/...
	go tool cover -html=coverage.out -o coverage.html
	@echo "è¦†ç›–ç‡æŠ¥å‘Šå·²ç”Ÿæˆ: coverage.html"

# ç”ŸæˆHTMLæµ‹è¯•æŠ¥å‘Š
report:
	@echo "ğŸ“„ ç”ŸæˆHTMLæµ‹è¯•æŠ¥å‘Š..."
	go run tests/run_integration_tests.go

# æ¸…ç†æµ‹è¯•æ–‡ä»¶
clean:
	@echo "ğŸ§¹ æ¸…ç†æµ‹è¯•æ–‡ä»¶..."
	rm -rf test_reports/
	rm -f coverage.out coverage.html
	rm -f *.db
	rm -f *.sqlite
	@echo "æ¸…ç†å®Œæˆ"

# å®‰è£…æµ‹è¯•ä¾èµ–
install-deps:
	@echo "ğŸ“¦ å®‰è£…æµ‹è¯•ä¾èµ–..."
	go get github.com/stretchr/testify/suite
	go get github.com/stretchr/testify/assert
	go get github.com/stretchr/testify/require
	@echo "ä¾èµ–å®‰è£…å®Œæˆ"

# è¿è¡Œæ€§èƒ½æµ‹è¯•
benchmark:
	@echo "âš¡ è¿è¡Œæ€§èƒ½æµ‹è¯•..."
	go test -v -bench=. -benchmem ./... ../framework/...

# è¿è¡Œç‰¹å®šæµ‹è¯•
test-specific:
	@echo "ğŸ¯ è¿è¡Œç‰¹å®šæµ‹è¯•..."
	@read -p "è¯·è¾“å…¥æµ‹è¯•å¥—ä»¶åç§°: " suite; \
	read -p "è¯·è¾“å…¥æµ‹è¯•åç§° (å¯é€‰): " test; \
	if [ -z "$$test" ]; then \
		go test -v ./tests/ -run "$$suite"; \
	else \
		go test -v ./tests/ -run "$$test"; \
	fi

# æ£€æŸ¥ä»£ç è´¨é‡
lint:
	@echo "ğŸ” æ£€æŸ¥ä»£ç è´¨é‡..."
	golangci-lint run ./... ../framework/...

# æ ¼å¼åŒ–ä»£ç 
format:
	@echo "ğŸ¨ æ ¼å¼åŒ–ä»£ç ..."
	go fmt ./... ../framework/...
	go vet ./... ../framework/...

# è¿è¡Œæµ‹è¯•å¹¶ç”ŸæˆæŠ¥å‘Š
test-with-report: test-all report
	@echo "âœ… æµ‹è¯•å®Œæˆï¼ŒæŠ¥å‘Šå·²ç”Ÿæˆ"

# å¿«é€Ÿæµ‹è¯•ï¼ˆè·³è¿‡æ…¢é€Ÿæµ‹è¯•ï¼‰
test-quick:
	@echo "âš¡ è¿è¡Œå¿«é€Ÿæµ‹è¯•..."
	go test -v -short ./... ../framework/...

# æ˜¾ç¤ºæµ‹è¯•å¸®åŠ©
test-help:
	@echo "æµ‹è¯•å‘½ä»¤å¸®åŠ©:"
	@echo "  -v          : è¯¦ç»†è¾“å‡º"
	@echo "  -short      : è·³è¿‡æ…¢é€Ÿæµ‹è¯•"
	@echo "  -run        : è¿è¡Œç‰¹å®šæµ‹è¯•"
	@echo "  -cover      : ç”Ÿæˆè¦†ç›–ç‡"
	@echo "  -bench      : è¿è¡ŒåŸºå‡†æµ‹è¯•"
	@echo "  -timeout    : è®¾ç½®è¶…æ—¶æ—¶é—´" 